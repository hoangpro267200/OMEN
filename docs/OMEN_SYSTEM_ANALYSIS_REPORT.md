# ðŸ“Š BÃO CÃO PHÃ‚N TÃCH Há»† THá»NG OMEN

> **NgÃ y táº¡o:** 01/02/2026  
> **PhiÃªn báº£n:** 2.0.0  
> **TÃ¡c giáº£:** OMEN Analysis Team

---

## Má»¤C Lá»¤C

1. [Tá»•ng quan dá»± Ã¡n](#1-tá»•ng-quan-dá»±-Ã¡n)
2. [Cáº¥u trÃºc thÆ° má»¥c](#2-cáº¥u-trÃºc-thÆ°-má»¥c)
3. [Kiáº¿n trÃºc há»‡ thá»‘ng](#3-kiáº¿n-trÃºc-há»‡-thá»‘ng)
4. [Chi tiáº¿t tá»«ng Module](#4-chi-tiáº¿t-tá»«ng-module)
5. [Data Sources & Adapters](#5-data-sources--adapters)
6. [Inbound & Outbound](#6-inbound--outbound)
7. [Configuration](#7-configuration)
8. [CÃ¡ch cháº¡y & Sá»­ dá»¥ng](#8-cÃ¡ch-cháº¡y--sá»­-dá»¥ng)
9. [API Reference](#9-api-reference)
10. [Äiá»ƒm máº¡nh & Háº¡n cháº¿](#10-Ä‘iá»ƒm-máº¡nh--háº¡n-cháº¿)
11. [Äá» xuáº¥t phÃ¡t triá»ƒn](#11-Ä‘á»-xuáº¥t-phÃ¡t-triá»ƒn)

---

## 1. Tá»”NG QUAN Dá»° ÃN

### 1.1 Má»¥c Ä‘Ã­ch chÃ­nh

**OMEN (Open Market Event Network)** lÃ  má»™t **Signal Intelligence Engine** vá»›i nhiá»‡m vá»¥:

- ðŸŽ¯ Biáº¿n Ä‘á»•i dá»¯ liá»‡u tá»« prediction markets (Polymarket) vÃ  cÃ¡c nguá»“n tÃ i chÃ­nh thÃ nh **tÃ­n hiá»‡u xÃ¡c suáº¥t cÃ³ cáº¥u trÃºc**
- ðŸ“Š Cung cáº¥p **confidence score** vÃ  **context** cho má»—i tÃ­n hiá»‡u
- ðŸ”’ **KHÃ”NG** Ä‘Æ°a ra impact assessment hay quyáº¿t Ä‘á»‹nh - chá»‰ cung cáº¥p thÃ´ng tin signal intelligence

### 1.2 CÃ´ng nghá»‡/Framework sá»­ dá»¥ng

#### Backend Stack

| Component | Technology | Version |
|-----------|------------|---------|
| Web Framework | FastAPI | â‰¥0.104.0 |
| ASGI Server | Uvicorn | â‰¥0.24.0 |
| Data Validation | Pydantic | â‰¥2.5.0 |
| Configuration | pydantic-settings | â‰¥2.1.0 |
| HTTP Client | httpx | â‰¥0.25.0 |
| Retry Logic | tenacity | â‰¥8.0.0 |
| Global Markets | yfinance | â‰¥0.2.36 |
| VN Markets | vnstock | â‰¥3.0.0 |
| Async Database | aiosqlite | â‰¥0.19.0 |
| Metrics | prometheus-client | â‰¥0.19.0 |
| Security | cryptography | â‰¥42.0.0 |
| YAML Config | pyyaml | â‰¥6.0.1 |
| WebSocket | websockets | â‰¥12.0 |
| JWT Auth | pyjwt | â‰¥2.8.0 |

#### Frontend Stack

| Component | Technology | Version |
|-----------|------------|---------|
| Framework | React | 19.2.0 |
| Language | TypeScript | 5.x |
| Build Tool | Vite | 7.2.4 |
| Styling | Tailwind CSS | 4.1.18 |
| State Management | TanStack Query | 5.90.20 |
| HTTP Client | Axios | 1.13.3 |
| Animations | Framer Motion | 12.29.2 |
| Charts | Recharts | 3.7.0 |
| Maps | React Simple Maps | 3.0.0 |
| Icons | Lucide React | 0.563.0 |

### 1.3 NgÃ´n ngá»¯ láº­p trÃ¬nh

- **Backend:** Python 3.10+ (type hints, async/await, dataclasses)
- **Frontend:** TypeScript + React 19 + JSX
- **Configuration:** YAML + Environment Variables
- **Scripts:** Python + Bash

---

## 2. Cáº¤U TRÃšC THÆ¯ Má»¤C

### 2.1 Tá»•ng quan cáº¥u trÃºc

```
OMEN/
â”œâ”€â”€ ðŸ“ src/                          # Source code chÃ­nh
â”‚   â”œâ”€â”€ ðŸ“ omen/                     # Core OMEN Engine
â”‚   â”‚   â”œâ”€â”€ ðŸ“ adapters/             # Inbound/Outbound adapters
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ inbound/          # Data sources (7 adapters)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ polymarket/   # Prediction markets
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ stock/        # Global + VN stocks
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ news/         # News/NLP
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ commodity/    # Commodity prices
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ ais/          # Ship tracking (AIS)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ weather/      # Weather data
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ freight/      # Freight rates
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ multi_source.py  # Multi-source aggregator
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ outbound/         # Output publishers
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ console_publisher.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ webhook_publisher.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ kafka_publisher.py
â”‚   â”‚   â”‚   â””â”€â”€ ðŸ“ persistence/      # Data persistence
â”‚   â”‚   â”œâ”€â”€ ðŸ“ api/                  # FastAPI routes
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ routes/           # API endpoints
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signals.py       # Signal CRUD
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ health.py        # Health checks
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ live.py          # Live processing
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ realtime.py      # SSE/WebSocket
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ activity.py      # Activity feed
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stats.py         # Statistics
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ dependencies.py      # FastAPI dependencies
â”‚   â”‚   â”‚   â””â”€â”€ models/              # API response models
â”‚   â”‚   â”œâ”€â”€ ðŸ“ application/          # Application services
â”‚   â”‚   â”‚   â”œâ”€â”€ pipeline.py          # Main processing pipeline
â”‚   â”‚   â”‚   â”œâ”€â”€ container.py         # Dependency injection
â”‚   â”‚   â”‚   â”œâ”€â”€ signal_pipeline.py   # Signal-only pipeline
â”‚   â”‚   â”‚   â””â”€â”€ ðŸ“ ports/            # Interfaces
â”‚   â”‚   â”‚       â”œâ”€â”€ signal_repository.py
â”‚   â”‚   â”‚       â”œâ”€â”€ output_publisher.py
â”‚   â”‚   â”‚       â””â”€â”€ signal_source.py
â”‚   â”‚   â”œâ”€â”€ ðŸ“ domain/               # Domain logic (core business)
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ models/           # Domain models
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ raw_signal.py    # RawSignalEvent
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ validated_signal.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ omen_signal.py   # Final OmenSignal
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ common.py        # Shared models
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ enums.py         # Enumerations
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ services/         # Domain services
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signal_validator.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signal_enricher.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signal_classifier.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ explanation_report.py
â”‚   â”‚   â”‚   â””â”€â”€ ðŸ“ rules/            # Validation rules
â”‚   â”‚   â”‚       â””â”€â”€ ðŸ“ validation/
â”‚   â”‚   â”‚           â”œâ”€â”€ liquidity_rule.py
â”‚   â”‚   â”‚           â”œâ”€â”€ anomaly_rule.py
â”‚   â”‚   â”‚           â”œâ”€â”€ semantic_relevance_rule.py
â”‚   â”‚   â”‚           â””â”€â”€ geographic_relevance_rule.py
â”‚   â”‚   â”œâ”€â”€ ðŸ“ infrastructure/       # Infrastructure components
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ security/         # Auth, rate limiting
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ ledger/           # Append-only ledger
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ metrics/          # Prometheus metrics
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ emitter/          # Signal emission
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ realtime/         # WebSocket/SSE
â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“ activity/         # Activity logging
â”‚   â”‚   â”‚   â””â”€â”€ ðŸ“ debug/            # Debug tools
â”‚   â”‚   â”œâ”€â”€ ðŸ“ config/               # YAML configurations
â”‚   â”‚   â”‚   â”œâ”€â”€ stock.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ news.yaml
â”‚   â”‚   â”‚   â””â”€â”€ commodities.yaml
â”‚   â”‚   â””â”€â”€ main.py                  # Application entry point
â”‚   â”œâ”€â”€ ðŸ“ omen_impact/              # Impact assessment module
â”‚   â”œâ”€â”€ ðŸ“ riskcast/                 # Risk reconciliation service
â”‚   â””â”€â”€ ðŸ“ data/                     # Demo data
â”œâ”€â”€ ðŸ“ omen-demo/                    # React frontend
â”‚   â”œâ”€â”€ ðŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ðŸ“ components/           # React components
â”‚   â”‚   â”œâ”€â”€ ðŸ“ hooks/                # Custom hooks
â”‚   â”‚   â”œâ”€â”€ ðŸ“ lib/                  # Utilities
â”‚   â”‚   â”œâ”€â”€ ðŸ“ screens/              # Page screens
â”‚   â”‚   â””â”€â”€ App.tsx                  # Main app
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ ðŸ“ config/                       # Infrastructure configs
â”‚   â”œâ”€â”€ prometheus.yml
â”‚   â””â”€â”€ ðŸ“ grafana/
â”œâ”€â”€ ðŸ“ scripts/                      # Utility scripts
â”œâ”€â”€ ðŸ“ tests/                        # Test suite
â”œâ”€â”€ ðŸ“ docs/                         # Documentation
â”œâ”€â”€ ðŸ“ terraform/                    # Infrastructure as Code
â”œâ”€â”€ pyproject.toml                   # Python project config
â”œâ”€â”€ docker-compose.yml               # Docker setup
â”œâ”€â”€ Dockerfile                       # Container image
â””â”€â”€ .env.example                     # Environment template
```

### 2.2 Má»‘i quan há»‡ giá»¯a cÃ¡c module

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              EXTERNAL SYSTEMS                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Polymarket  â”‚ â”‚  yfinance   â”‚ â”‚  NewsAPI    â”‚ â”‚AlphaVantage â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ OpenWeather â”‚ â”‚  AISHub     â”‚ â”‚  Freightos  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ADAPTERS LAYER                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    INBOUND ADAPTERS                                  â”‚    â”‚
â”‚  â”‚  polymarket/ â”‚ stock/ â”‚ news/ â”‚ commodity/ â”‚ ais/ â”‚ weather/ â”‚ freight/ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚ RawSignalEvent                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  MULTI-SOURCE AGGREGATOR                            â”‚    â”‚
â”‚  â”‚           Collects, deduplicates, sorts by timestamp                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           APPLICATION LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      OMEN PIPELINE                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚ Idempotency  â”‚â”€â–¶â”‚  Validation  â”‚â”€â–¶â”‚  Enrichment  â”‚â”€â–¶ OmenSignal  â”‚    â”‚
â”‚  â”‚  â”‚    Check     â”‚  â”‚   (Rules)    â”‚  â”‚  (Context)   â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      CONTAINER (DI)                                  â”‚    â”‚
â”‚  â”‚  SignalValidator â”‚ SignalEnricher â”‚ Repository â”‚ Publisher           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DOMAIN LAYER                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         MODELS                                       â”‚    â”‚
â”‚  â”‚  RawSignalEvent â”€â”€â–¶ ValidatedSignal â”€â”€â–¶ OmenSignal                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        SERVICES                                      â”‚    â”‚
â”‚  â”‚  SignalValidator â”‚ SignalEnricher â”‚ SignalClassifier                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         RULES                                        â”‚    â”‚
â”‚  â”‚  LiquidityRule â”‚ AnomalyRule â”‚ SemanticRule â”‚ GeographicRule         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        INFRASTRUCTURE LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Security â”‚  â”‚   Ledger  â”‚  â”‚  Metrics  â”‚  â”‚  Emitter  â”‚                â”‚
â”‚  â”‚  - Auth   â”‚  â”‚  - WAL    â”‚  â”‚- Prometheusâ”‚ â”‚- Dual-pathâ”‚                â”‚
â”‚  â”‚  - Rate   â”‚  â”‚  - CRC    â”‚  â”‚- Latency  â”‚  â”‚- RiskCast â”‚                â”‚
â”‚  â”‚  - Audit  â”‚  â”‚  - Query  â”‚  â”‚- Counters â”‚  â”‚           â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           OUTPUT LAYER                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Console   â”‚  â”‚   Webhook   â”‚  â”‚    Kafka    â”‚  â”‚   RiskCast  â”‚        â”‚
â”‚  â”‚  Publisher  â”‚  â”‚  Publisher  â”‚  â”‚  Publisher  â”‚  â”‚  (Hot Path) â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. KIáº¾N TRÃšC Há»† THá»NG

### 3.1 Architecture Pattern

OMEN sá»­ dá»¥ng **Clean Architecture / Hexagonal Architecture**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                   DOMAIN LAYER                       â”‚     â”‚
â”‚    â”‚         (Business Logic - Pure Python)               â”‚     â”‚
â”‚    â”‚                                                       â”‚     â”‚
â”‚    â”‚   Models: RawSignal, ValidatedSignal, OmenSignal     â”‚     â”‚
â”‚    â”‚   Services: Validator, Enricher, Classifier          â”‚     â”‚
â”‚    â”‚   Rules: Liquidity, Anomaly, Semantic, Geographic    â”‚     â”‚
â”‚    â”‚                                                       â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                             â”‚                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚               APPLICATION LAYER                      â”‚     â”‚
â”‚    â”‚            (Use Cases & Orchestration)               â”‚     â”‚
â”‚    â”‚                                                       â”‚     â”‚
â”‚    â”‚   Pipeline: process_single(), process_batch()        â”‚     â”‚
â”‚    â”‚   Container: Dependency Injection                    â”‚     â”‚
â”‚    â”‚   Ports: Repository, Publisher, Source (interfaces)  â”‚     â”‚
â”‚    â”‚                                                       â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                             â”‚                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚               ADAPTERS LAYER                         â”‚     â”‚
â”‚    â”‚         (External System Implementations)            â”‚     â”‚
â”‚    â”‚                                                       â”‚     â”‚
â”‚    â”‚   Inbound: Polymarket, Stock, News, Commodity...     â”‚     â”‚
â”‚    â”‚   Outbound: Console, Webhook, Kafka                  â”‚     â”‚
â”‚    â”‚   Persistence: InMemory, Ledger                      â”‚     â”‚
â”‚    â”‚                                                       â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Data Flow Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          OMEN PROCESSING PIPELINE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Data Source â”‚ (Polymarket, Stock, News, etc.)
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚ fetch_events()
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         LAYER 1: INPUT                                   â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚                    RawSignalEvent                                â”‚    â”‚
    â”‚  â”‚  - event_id: unique identifier                                   â”‚    â”‚
    â”‚  â”‚  - title, description                                            â”‚    â”‚
    â”‚  â”‚  - probability: 0.0 - 1.0                                        â”‚    â”‚
    â”‚  â”‚  - market: MarketMetadata                                        â”‚    â”‚
    â”‚  â”‚  - keywords, inferred_locations                                  â”‚    â”‚
    â”‚  â”‚  - input_event_hash (computed, deterministic)                    â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       LAYER 2: VALIDATION                                â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚                    SignalValidator                               â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  Rule 1: LiquidityValidationRule                                 â”‚    â”‚
    â”‚  â”‚          â”œâ”€â”€ Check: liquidity >= $10,000                        â”‚    â”‚
    â”‚  â”‚          â””â”€â”€ Fast filter for low-quality markets                 â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  Rule 2: AnomalyDetectionRule                                    â”‚    â”‚
    â”‚  â”‚          â”œâ”€â”€ Check: price manipulation patterns                  â”‚    â”‚
    â”‚  â”‚          â””â”€â”€ Detect wash trading, spoofing                       â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  Rule 3: SemanticRelevanceRule                                   â”‚    â”‚
    â”‚  â”‚          â”œâ”€â”€ Check: logistics-relevant keywords                  â”‚    â”‚
    â”‚  â”‚          â””â”€â”€ Score based on keyword matching                     â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  Rule 4: GeographicRelevanceRule                                 â”‚    â”‚
    â”‚  â”‚          â”œâ”€â”€ Check: location extraction                          â”‚    â”‚
    â”‚  â”‚          â””â”€â”€ Score based on chokepoint/port relevance            â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚                                                                          â”‚
    â”‚  Output: ValidatedSignal (if passed) or Rejection (with reason)         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       LAYER 3: ENRICHMENT                                â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚                    SignalEnricher                                â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Keyword Extraction                                       â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Extract domain keywords (shipping, port, canal...)     â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Categorize by topic                                    â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Geographic Context                                       â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Extract regions (Asia, Europe, Americas...)           â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Identify chokepoints (Suez, Panama, Malacca...)       â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Temporal Context                                         â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Event horizon estimation                               â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Resolution date                                        â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Confidence Factors                                       â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Liquidity score                                        â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Source reliability                                     â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - Data freshness                                         â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     LAYER 4: SIGNAL GENERATION                           â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚                      OmenSignal                                  â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Identity                                                 â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - signal_id: OMEN-XXXXXXXXXXXX                          â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - source_event_id, trace_id                             â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - input_event_hash (for deduplication)                  â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Probability                                              â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - probability: 0.0 - 1.0 (from market)                  â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - probability_source: "polymarket", "stock", etc.       â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - probability_uncertainty: Â±X%                          â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Confidence                                               â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - confidence_score: 0.0 - 1.0                           â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - confidence_level: HIGH / MEDIUM / LOW                 â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - confidence_factors: {liquidity, geographic, source}   â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Classification                                           â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - signal_type: DISRUPTION, WEATHER, GEOPOLITICAL...     â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - category: LOGISTICS, INFRASTRUCTURE, POLITICAL...     â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - tags: [strike, blockage, congestion...]               â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â”‚                                                                  â”‚    â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
    â”‚  â”‚  â”‚ Context                                                  â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - geographic: {regions, chokepoints}                    â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - temporal: {event_horizon, resolution_date}            â”‚    â”‚    â”‚
    â”‚  â”‚  â”‚ - evidence: [{source, source_type, url}]                â”‚    â”‚    â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         LAYER 5: OUTPUT                                  â”‚
    â”‚                                                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
    â”‚  â”‚    Ledger    â”‚  â”‚   Webhook    â”‚  â”‚   Console    â”‚                   â”‚
    â”‚  â”‚  (WAL-safe)  â”‚  â”‚  (HTTP POST) â”‚  â”‚   (stdout)   â”‚                   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
    â”‚          â”‚                                                               â”‚
    â”‚          â–¼                                                               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
    â”‚  â”‚   RiskCast   â”‚  (Hot Path for reconciliation)                        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Key Architecture Principles

1. **Deterministic Processing**: CÃ¹ng input â†’ cÃ¹ng output (reproducible)
2. **Immutability**: Domain models are frozen/immutable
3. **Separation of Concerns**: Domain logic tÃ¡ch biá»‡t vá»›i adapters
4. **Dependency Inversion**: Core depends on abstractions (ports), not implementations
5. **Fail-Safe**: Crash-safe ledger, retry logic, circuit breakers
6. **Observability**: Metrics, logging, tracing at every layer

---

## 4. CHI TIáº¾T Tá»ªNG MODULE

### 4.1 Domain Models

#### RawSignalEvent (Layer 1 - Input)

**Location:** `src/omen/domain/models/raw_signal.py`

```python
class RawSignalEvent(BaseModel):
    """Normalized prediction market event - input to pipeline."""
    
    # Identity
    event_id: str           # Unique event identifier
    title: str              # Event title (max 500 chars)
    description: str | None # Event description (max 5000 chars)
    
    # Probability
    probability: float      # 0.0 - 1.0 (YES probability)
    probability_is_fallback: bool  # True if using default 0.5
    movement: ProbabilityMovement | None
    
    # Classification hints
    keywords: list[str]     # Extracted keywords
    inferred_locations: list[GeoLocation]
    
    # Market metadata
    market: MarketMetadata  # Source market info
    
    # Timestamps
    observed_at: datetime   # When OMEN observed this
    market_last_updated: datetime | None
    
    # Source-specific data
    source_metrics: dict[str, Any]  # AIS, Weather, Stock metrics
    
    # Computed field
    @computed_field
    def input_event_hash(self) -> str:
        """Deterministic hash for deduplication."""
```

#### ValidatedSignal (Layer 2 - Validation Output)

**Location:** `src/omen/domain/models/validated_signal.py`

```python
class ValidatedSignal(BaseModel):
    """Signal after validation - includes validation metadata."""
    
    event: RawSignalEvent           # Original event
    validation_results: list[ValidationResult]
    overall_validation_score: float # Combined score
    liquidity_score: float
    explanation: ExplanationChain   # Audit trail
    deterministic_trace_id: str     # For replay
```

#### OmenSignal (Layer 4 - Final Output)

**Location:** `src/omen/domain/models/omen_signal.py`

```python
class OmenSignal(BaseModel):
    """Final signal contract for downstream systems."""
    
    # Identity
    signal_id: str          # OMEN-XXXXXXXXXXXX
    source_event_id: str
    trace_id: str
    input_event_hash: str
    
    # Content
    title: str
    description: str
    
    # Probability (from market - OMEN does NOT calculate)
    probability: float
    probability_source: str
    probability_is_estimate: bool
    probability_uncertainty: float | None
    
    # Confidence (OMEN calculates this)
    confidence_score: float
    confidence_level: ConfidenceLevel  # HIGH/MEDIUM/LOW
    confidence_factors: dict[str, float]
    
    # Classification
    signal_type: SignalType
    status: SignalStatus
    category: SignalCategory
    tags: list[str]
    
    # Context
    geographic: GeographicContext
    temporal: TemporalContext
    evidence: list[Evidence]
    
    # Impact hints (metadata only, NOT assessment)
    impact_hints: ImpactHints
    
    # Metadata
    ruleset_version: str
    generated_at: datetime
```

### 4.2 Domain Services

#### SignalValidator

**Location:** `src/omen/domain/services/signal_validator.py`

```python
class SignalValidator:
    """Orchestrates multi-rule validation."""
    
    def __init__(self, rules: list[Rule]):
        self.rules = rules  # Ordered list of validation rules
    
    def validate(
        self, 
        event: RawSignalEvent, 
        context: ProcessingContext
    ) -> ValidationOutcome:
        """
        Run all rules sequentially.
        Returns ValidationOutcome with:
        - passed: bool
        - validated_signal: ValidatedSignal (if passed)
        - rejection_reason: str (if failed)
        """
    
    @classmethod
    def create_default(cls) -> "SignalValidator":
        """Create with default rules in order:
        1. LiquidityValidationRule (fast filter)
        2. AnomalyDetectionRule
        3. SemanticRelevanceRule
        4. GeographicRelevanceRule
        """
```

#### SignalEnricher

**Location:** `src/omen/domain/services/signal_enricher.py`

```python
class SignalEnricher:
    """Adds context to validated signals."""
    
    def enrich(
        self, 
        event: RawSignalEvent, 
        validation_context: dict
    ) -> EnrichmentResult:
        """
        Extract and add:
        - Keywords and categories
        - Geographic context (regions, chokepoints)
        - Temporal context (event horizon, resolution date)
        - Confidence factors
        """
```

### 4.3 Validation Rules

| Rule | Purpose | Threshold |
|------|---------|-----------|
| **LiquidityValidationRule** | Filter low-liquidity markets | â‰¥ $10,000 |
| **AnomalyDetectionRule** | Detect manipulation patterns | Z-score < 3.0 |
| **SemanticRelevanceRule** | Check logistics relevance | Score â‰¥ 0.3 |
| **GeographicRelevanceRule** | Check location relevance | Score â‰¥ 0.2 |

### 4.4 Application Services

#### OmenPipeline

**Location:** `src/omen/application/pipeline.py`

```python
class OmenPipeline:
    """Main processing pipeline."""
    
    def __init__(
        self,
        validator: SignalValidator,
        enricher: SignalEnricher,
        repository: SignalRepository,
        publisher: OutputPublisher,
    ):
        self.validator = validator
        self.enricher = enricher
        self.repository = repository
        self.publisher = publisher
    
    def process_single(
        self, 
        event: RawSignalEvent, 
        context: ProcessingContext
    ) -> PipelineResult:
        """
        Process single event through pipeline:
        1. Idempotency check (skip if already processed)
        2. Validation (rules)
        3. Enrichment (context)
        4. Signal generation (OmenSignal)
        5. Persistence (repository)
        6. Publishing (webhook/console)
        """
    
    def process_batch(
        self, 
        events: list[RawSignalEvent]
    ) -> list[PipelineResult]:
        """Process multiple events."""
```

#### Container (Dependency Injection)

**Location:** `src/omen/application/container.py`

```python
class Container:
    """Wires all components together."""
    
    def __init__(self, config: Config):
        self._validator = SignalValidator.create_default()
        self._enricher = SignalEnricher()
        self._repository = InMemoryRepository()
        self._publisher = self._create_publisher(config)
        self._pipeline = OmenPipeline(
            validator=self._validator,
            enricher=self._enricher,
            repository=self._repository,
            publisher=self._publisher,
        )
    
    @property
    def pipeline(self) -> OmenPipeline:
        return self._pipeline
```

---

## 5. DATA SOURCES & ADAPTERS

### 5.1 Inbound Adapters Overview

| # | Adapter | Provider | Data Type | Status | Weight |
|---|---------|----------|-----------|--------|--------|
| 1 | **Polymarket** | Public API | Prediction markets | âœ… Working | 1.0 |
| 2 | **Stock** | yfinance + vnstock | Stocks, Forex, Bonds | âœ… Working | 0.9 |
| 3 | **News** | NewsAPI.org | News articles | âœ… Working | 0.8 |
| 4 | **Commodity** | AlphaVantage | Commodity prices | âœ… Working | 0.7 |
| 5 | **Weather** | OpenWeatherMap | Storm alerts | âœ… Working | 1.1 |
| 6 | **AIS** | AISHub/MarineTraffic | Ship tracking | âš ï¸ Mock | 1.2 |
| 7 | **Freight** | Freightos/Drewry | Freight rates | âš ï¸ Mock | 1.0 |

### 5.2 Stock Adapter Detail

**Location:** `src/omen/adapters/inbound/stock/`

#### Watchlist

**Global Markets (yfinance):**

| Category | Symbols | Description |
|----------|---------|-------------|
| **Indices** | SPX (^GSPC), NDX (^NDX), DJI (^DJI), VIX (^VIX) | US market sentiment |
| **Forex** | DXY, EURUSD, USDJPY, USDVND, USDCNY | Currency movements |
| **Bonds** | US10Y (^TNX), US2Y (^IRX), US30Y (^TYX) | Interest rates |
| **Commodities** | Gold (GC=F), Silver (SI=F), WTI (CL=F), Brent (BZ=F), NatGas (NG=F), Copper (HG=F) | Raw materials |

**Vietnam Markets (vnstock):**

| Category | Symbols | Description |
|----------|---------|-------------|
| **Indices** | VNINDEX, VN30, HNX | VN market sentiment |
| **Stocks** | VNM, VIC, VHM, VCB, FPT, HPG, MSN, MWG, TCB, ACB | Top VN companies |

#### Spike Detection

```python
class SpikeDetector:
    """Detects significant price movements."""
    
    def detect_from_quote(self, quote: StockQuote) -> StockSpike | None:
        """
        Detect spike based on:
        - Percentage change vs threshold
        - Z-score calculation
        - Severity classification (minor/moderate/major/extreme)
        """
```

### 5.3 News Adapter Detail

**Location:** `src/omen/adapters/inbound/news/`

#### Quality Gate

```python
class NewsQualityGate:
    """Filters low-quality news."""
    
    def evaluate(self, article: NewsArticle) -> QualityScore:
        """
        Score based on:
        - Source credibility (tier 1-4)
        - Recency decay (exponential)
        - Deduplication (similarity check)
        - Topic relevance
        """
```

#### Credibility Tiers

| Tier | Score | Examples |
|------|-------|----------|
| **Tier 1** | 0.95 | Reuters, Bloomberg, WSJ, FT |
| **Tier 2** | 0.80 | BBC, NYT, Guardian, CNBC |
| **Tier 3** | 0.60 | Industry publications |
| **Tier 4** | 0.40 | Regional news |
| **Default** | 0.30 | Unknown sources |

### 5.4 AIS Adapter Detail

**Location:** `src/omen/adapters/inbound/ais/`

#### Monitored Ports

| Code | Port | Country | Region |
|------|------|---------|--------|
| SGSIN | Singapore | Singapore | Southeast Asia |
| CNSHA | Shanghai | China | East Asia |
| USLAX | Los Angeles | USA | North America |
| NLRTM | Rotterdam | Netherlands | Europe |
| VNSGN | Ho Chi Minh City | Vietnam | Southeast Asia |
| VNHPH | Hai Phong | Vietnam | Southeast Asia |

#### Monitored Chokepoints

| Chokepoint | Location | Daily Transits |
|------------|----------|----------------|
| Suez Canal | Egypt | 50 |
| Panama Canal | Panama | 35 |
| Strait of Malacca | Malaysia/Indonesia | 80 |
| Strait of Hormuz | Iran/Oman | 20 |
| Bab el-Mandeb | Yemen/Djibouti | 30 |

### 5.5 Multi-Source Aggregator

**Location:** `src/omen/adapters/inbound/multi_source.py`

```python
class MultiSourceAggregator:
    """Aggregates signals from all sources."""
    
    def fetch_all(
        self, 
        limit_per_source: int = 50,
        sources: list[str] | None = None
    ) -> list[RawSignalEvent]:
        """
        1. Fetch from each enabled source
        2. Deduplicate events
        3. Sort by timestamp (newest first)
        4. Return combined list
        """
    
    def get_source_health(self) -> dict[str, dict]:
        """Check health of all sources."""
```

---

## 6. INBOUND & OUTBOUND

### 6.1 SignalSource Interface

**Location:** `src/omen/application/ports/signal_source.py`

```python
class SignalSource(ABC):
    """Interface for all inbound adapters."""
    
    @property
    @abstractmethod
    def source_name(self) -> str:
        """Identifier (e.g., 'polymarket', 'stock')."""
    
    @abstractmethod
    def fetch_events(self, limit: int = 100) -> Iterator[RawSignalEvent]:
        """Fetch events from source."""
    
    @abstractmethod
    async def fetch_events_async(self, limit: int) -> AsyncIterator[RawSignalEvent]:
        """Async version."""
    
    @abstractmethod
    def fetch_by_id(self, market_id: str) -> RawSignalEvent | None:
        """Fetch specific event."""
```

### 6.2 OutputPublisher Interface

**Location:** `src/omen/application/ports/output_publisher.py`

```python
class OutputPublisher(ABC):
    """Interface for all outbound adapters."""
    
    @abstractmethod
    def publish(self, signal: OmenSignal) -> bool:
        """Publish signal to downstream."""
    
    @abstractmethod
    def publish_batch(self, signals: list[OmenSignal]) -> int:
        """Publish multiple signals."""
```

### 6.3 Outbound Implementations

#### ConsolePublisher

```python
class ConsolePublisher(OutputPublisher):
    """Output to stdout (JSON format)."""
    
    def publish(self, signal: OmenSignal) -> bool:
        print(signal.model_dump_json(indent=2))
        return True
```

#### WebhookPublisher

```python
class WebhookPublisher(OutputPublisher):
    """HTTP POST to webhook endpoint."""
    
    def __init__(
        self,
        url: str,
        secret: str | None = None,  # HMAC signature
        timeout: float = 30.0,
        max_retries: int = 3,
    ):
        ...
    
    def publish(self, signal: OmenSignal) -> bool:
        """
        1. Redact sensitive fields
        2. Sign payload with HMAC (if secret)
        3. POST to webhook URL
        4. Retry with exponential backoff
        """
```

### 6.4 Dual-Path Emission

**Location:** `src/omen/infrastructure/emitter/signal_emitter.py`

```
                    OmenSignal
                        â”‚
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Signal Emitter â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚            â”‚            â”‚
          â–¼            â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Ledger  â”‚ â”‚ Hot Path â”‚ â”‚ Publisherâ”‚
    â”‚  (WAL)   â”‚ â”‚(RiskCast)â”‚ â”‚ (Webhook)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    Reconciliation (recover from failures)
```

---

## 7. CONFIGURATION

### 7.1 Environment Variables

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# OMEN Environment Configuration
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Security
OMEN_SECURITY_API_KEYS=dev-test-key
OMEN_SECURITY_RATE_LIMIT_ENABLED=false
OMEN_SECURITY_RATE_LIMIT_REQUESTS_PER_MINUTE=600

# Data Sources - Phase 2
NEWS_API_KEY=your_newsapi_key
ALPHAVANTAGE_API_KEY=your_alphavantage_key

# Data Sources - Phase 1 (Logistics)
OMEN_WEATHER_PROVIDER=openweather
OMEN_WEATHER_OPENWEATHER_API_KEY=your_openweather_key
OMEN_AIS_PROVIDER=mock  # or aishub, marinetraffic
OMEN_FREIGHT_PROVIDER=mock  # or freightos, drewry

# Stock Configuration
STOCK_PROVIDER=both  # yfinance, vnstock, both, mock
STOCK_ENABLE_YFINANCE=true
STOCK_ENABLE_VNSTOCK=true

# Output
WEBHOOK_URL=https://your-webhook.com/signals
```

### 7.2 YAML Configuration Files

#### stock.yaml

**Location:** `src/omen/config/stock.yaml`

```yaml
settings:
  default_provider: both
  timeout_seconds: 30.0
  retry_attempts: 3
  lookback_days: 30

spike_detection:
  default_threshold_pct: 3.0
  zscore_threshold: 2.0
  severity_levels:
    minor: {min_pct: 1.0, max_pct: 3.0}
    moderate: {min_pct: 3.0, max_pct: 5.0}
    major: {min_pct: 5.0, max_pct: 10.0}
    extreme: {min_pct: 10.0, max_pct: null}

watchlist:
  - symbol: SPX
    name: S&P 500
    yf_symbol: "^GSPC"
    category: index
    spike_threshold_pct: 2.0
  # ... more symbols
```

#### news.yaml

**Location:** `src/omen/config/news.yaml`

```yaml
providers:
  newsapi:
    timeout_seconds: 20.0
    max_results: 100

quality_gate:
  min_credibility: 0.3
  min_recency: 0.1
  min_combined_score: 0.2

credibility:
  tier_1:
    score: 0.95
    domains: [reuters.com, bloomberg.com, wsj.com]
  tier_2:
    score: 0.80
    domains: [bbc.com, nytimes.com, cnbc.com]
  # ... more tiers

topic_keywords:
  logistics:
    primary: [shipping, freight, port, container]
    secondary: [supply chain, cargo, vessel]
```

---

## 8. CÃCH CHáº Y & Sá»¬ Dá»¤NG

### 8.1 CÃ i Ä‘áº·t

```bash
# Clone repository
git clone https://github.com/your-org/omen.git
cd omen

# Create virtual environment
python -m venv venv
source venv/bin/activate  # Linux/Mac
# or
.\venv\Scripts\activate  # Windows

# Install Python dependencies
pip install -e .
# or
pip install -e ".[dev]"  # Include dev dependencies

# Install frontend dependencies
cd omen-demo
npm install
```

### 8.2 Configuration

```bash
# Copy environment template
cp .env.example .env

# Edit .env with your API keys
# Required:
# - NEWS_API_KEY (from newsapi.org)
# - ALPHAVANTAGE_API_KEY (from alphavantage.co)
# - OPENWEATHER_API_KEY (from openweathermap.org)
```

### 8.3 Cháº¡y á»©ng dá»¥ng

#### Backend

```bash
# Set PYTHONPATH
export PYTHONPATH=src  # Linux/Mac
$env:PYTHONPATH = "src"  # PowerShell

# Run with hot reload (development)
python -m uvicorn omen.main:app --host 0.0.0.0 --port 8002 --reload

# Run production
python -m uvicorn omen.main:app --host 0.0.0.0 --port 8002 --workers 4
```

#### Frontend

```bash
cd omen-demo

# Development
npm run dev -- --port 5174

# Build for production
npm run build

# Preview production build
npm run preview
```

### 8.4 Utility Scripts

| Script | Command | Purpose |
|--------|---------|---------|
| **Run Pipeline** | `python scripts/run_pipeline.py` | CLI runner |
| **Seed Demo Data** | `python scripts/seed_demo_data.py` | Seed test data |
| **Reset Demo** | `python scripts/demo_reset.py` | Reset environment |
| **Certification Check** | `python scripts/certification_check.py` | Validate compliance |
| **Network Diagnostic** | `python scripts/polymarket_doctor.py` | Check Polymarket APIs |

### 8.5 Docker

```bash
# Build and run with Docker Compose
docker-compose up -d

# Production
docker-compose -f docker-compose.prod.yml up -d
```

---

## 9. API REFERENCE

### 9.1 Health Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/health/` | GET | Basic health check |
| `/health/ready` | GET | Readiness check (K8s) |
| `/health/live` | GET | Liveness check (K8s) |

### 9.2 Signal Endpoints (Requires API Key)

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/v1/signals/` | GET | List signals (paginated) |
| `/api/v1/signals/{id}` | GET | Get signal by ID |
| `/api/v1/signals/process` | POST | Process events â†’ signals |
| `/api/v1/signals/stats` | GET | Pipeline statistics |

### 9.3 Live Processing Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/v1/live/process` | POST | Process live Polymarket events |
| `/api/v1/live/process-single` | POST | Process single event by ID |

### 9.4 Real-time Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/v1/realtime/subscribe` | POST | Subscribe to price updates |
| `/api/v1/realtime/prices` | GET | SSE stream of prices |
| `/api/v1/realtime/status` | GET | Streaming status |

### 9.5 UI Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/ui/overview` | GET | Dashboard KPIs |
| `/api/ui/signals` | GET | Signals for UI |
| `/api/ui/partitions` | GET | Ledger partitions |

### 9.6 Example API Calls

```bash
# Health check
curl http://localhost:8002/health

# Process signals (requires API key)
curl -X POST http://localhost:8002/api/v1/signals/process \
  -H "X-API-Key: dev-test-key" \
  -H "Content-Type: application/json"

# Get signals
curl http://localhost:8002/api/v1/signals/ \
  -H "X-API-Key: dev-test-key"

# Get UI overview
curl http://localhost:8002/api/ui/overview
```

---

## 10. ÄIá»‚M Máº NH & Háº N CHáº¾

### 10.1 Äiá»ƒm máº¡nh âœ…

| # | Äiá»ƒm máº¡nh | MÃ´ táº£ |
|---|-----------|-------|
| 1 | **Clean Architecture** | Domain logic hoÃ n toÃ n tÃ¡ch biá»‡t vá»›i adapters |
| 2 | **7 Data Sources** | Äa dáº¡ng: markets, stocks, news, commodities, logistics |
| 3 | **Deterministic Pipeline** | CÃ¹ng input â†’ cÃ¹ng output, reproducible |
| 4 | **Crash-Safe Ledger** | WAL vá»›i CRC validation, partition-based |
| 5 | **Comprehensive Security** | API key, JWT, rate limiting, audit logging |
| 6 | **Real-time Updates** | WebSocket/SSE for live price streaming |
| 7 | **Full Observability** | Prometheus metrics, activity logging, debug endpoints |
| 8 | **Modern Stack** | Python 3.10+, FastAPI, React 19, TypeScript |
| 9 | **Config-Driven** | YAML configs, environment variables |
| 10 | **Vietnamese Support** | vnstock integration, VN markets |
| 11 | **Extensible Design** | Easy to add new adapters via ports |
| 12 | **Production Features** | Graceful shutdown, health checks, metrics |

### 10.2 Háº¡n cháº¿ âš ï¸

| # | Háº¡n cháº¿ | Impact | Giáº£i phÃ¡p |
|---|---------|--------|-----------|
| 1 | **AIS/Freight Mock** | Limited real data | Get paid API keys |
| 2 | **Kafka Stub** | No event streaming | Implement Kafka publisher |
| 3 | **In-Memory Only** | No persistence | Add PostgreSQL/TimescaleDB |
| 4 | **VNStock Dependency** | Some symbols unavailable | Fallback to yfinance VN ADRs |
| 5 | **API Rate Limits** | Free tiers limited | Use paid tiers or caching |
| 6 | **Replay System** | Not complete | Implement full replay |
| 7 | **No Mobile App** | Web only | React Native version |
| 8 | **Limited Tests** | Coverage gaps | Add E2E tests |

---

## 11. Äá»€ XUáº¤T PHÃT TRIá»‚N

### 11.1 Short-term (1-2 months)

| Priority | Feature | Effort |
|----------|---------|--------|
| ðŸ”´ High | Complete Kafka publisher | 1 week |
| ðŸ”´ High | Add PostgreSQL persistence | 2 weeks |
| ðŸŸ¡ Medium | Implement full replay system | 2 weeks |
| ðŸŸ¡ Medium | Add E2E tests | 1 week |
| ðŸŸ¢ Low | Redis caching layer | 1 week |

### 11.2 Medium-term (3-6 months)

| Priority | Feature | Effort |
|----------|---------|--------|
| ðŸ”´ High | LLM-based news analysis (optional) | 3 weeks |
| ðŸ”´ High | Alert/notification system | 2 weeks |
| ðŸŸ¡ Medium | Backtesting framework | 4 weeks |
| ðŸŸ¡ Medium | API Gateway with versioning | 2 weeks |
| ðŸŸ¢ Low | Mobile app (React Native) | 6 weeks |

### 11.3 Long-term (6+ months)

| Feature | Description |
|---------|-------------|
| **ML Pipeline** | Anomaly detection, trend prediction |
| **Multi-tenant** | Support multiple organizations |
| **Global CDN** | Edge deployment for low latency |
| **Data Marketplace** | Sell signal data to subscribers |

### 11.4 Architecture Improvements

```
Current:                          Proposed:
                                  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OMEN   â”‚                     â”‚   OMEN   â”‚
â”‚ (monolith)â”‚         â”€â”€â”€â–¶       â”‚  (API)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                      â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚          â”‚          â”‚
                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
                      â”‚ Workers â”‚ â”‚ Cache â”‚ â”‚   DB   â”‚
                      â”‚ (Celery)â”‚ â”‚(Redis)â”‚ â”‚(Postgres)â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Káº¾T LUáº¬N

**OMEN** lÃ  má»™t há»‡ thá»‘ng Signal Intelligence Engine hoÃ n chá»‰nh vá»›i:

âœ… **7 data sources** tÃ­ch há»£p (Polymarket, Stock, News, Commodity, AIS, Weather, Freight)  
âœ… **Clean architecture** vá»›i domain-driven design  
âœ… **Deterministic pipeline** cho reproducible results  
âœ… **Modern tech stack** (FastAPI, React 19, TypeScript)  
âœ… **Production-ready features** (security, metrics, ledger, real-time)  

Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng cho **development vÃ  demo**, vá»›i cÃ¡c tÃ­nh nÄƒng core hoáº¡t Ä‘á»™ng tá»‘t. Cáº§n thÃªm má»™t sá»‘ API keys vÃ  complete má»™t sá»‘ stubs Ä‘á»ƒ Ä‘áº¡t **production-ready** hoÃ n toÃ n.

---

> **Document Version:** 2.0.0  
> **Last Updated:** 01/02/2026  
> **Generated by:** OMEN Analysis System
